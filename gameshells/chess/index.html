<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chess (2D) — Gurjot's Games</title>
    <link rel="stylesheet" href="/css/styles.css?v=5.3" />
    <script type="importmap">
    {
      "imports": {
        "console-signature": "../../js/vendor/console-signature.js",
        "three": "../../vendor/three/0.161.0/build/three.module.js"
      }
    }
    </script>
    <style>
      :root {
        color-scheme: dark;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background:
          linear-gradient(160deg, #050b14 0%, #0a1424 55%, #101d33 100%),
          repeating-linear-gradient(
            45deg,
            rgba(22, 32, 52, 0.7) 0,
            rgba(22, 32, 52, 0.7) 48px,
            rgba(13, 23, 40, 0.7) 48px,
            rgba(13, 23, 40, 0.7) 96px
          );
        color: #e6e7ea;
        overflow: hidden;
        position: relative;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background: radial-gradient(circle at 75% 15%, rgba(59, 130, 246, 0.22), transparent 55%);
        opacity: 0.6;
        mix-blend-mode: screen;
      }
    </style>
  </head>
  <body>
    <main style="display:flex;gap:16px;justify-content:center;align-items:flex-start;padding:16px 16px 80px;">
      <div style="position:relative;">
        <canvas
          id="board"
          width="480"
          height="480"
          aria-label="Chess board"
          style="border:1px solid #243047;border-radius:12px;background:#0f172a;"
        ></canvas>
        <canvas
          id="fx"
          width="480"
          height="480"
          aria-hidden="true"
          style="position:absolute;left:0;top:0;pointer-events:none;"
        ></canvas>
      </div>
      <aside style="max-width:320px;display:flex;flex-direction:column;gap:16px;">
        <h1 style="margin:0 0 8px 0;font-size:1.5rem;">Chess</h1>
        <p style="margin:0 0 12px;">
          Click a piece, then a target square.<br />
          Press <b>R</b> to restart.<br />
          Press <b>F1</b> for control remap.
        </p>
        <label for="difficulty">Difficulty:</label>
        <select id="difficulty" style="display:block;margin:4px 0 12px;">
          <option value="1">Easy</option>
          <option value="2" selected>Medium</option>
          <option value="3">Hard</option>
          <option value="4">Expert</option>
        </select>
        <label for="time-control">Time Control:</label>
        <select id="time-control" style="display:block;margin:4px 0 4px;">
          <option value="none">Free Play (∞)</option>
          <option value="rapid" selected>Rapid 10 | 5</option>
          <option value="blitz">Blitz 5 | 3</option>
          <option value="bullet">Bullet 1 | 0</option>
          <option value="classic">Classical 15 | 10</option>
        </select>
        <div id="clock-mode-label" style="font-size:0.9rem;color:#9ca3af;">Rapid 10 | 5</div>
        <section
          aria-label="Match clock"
          style="display:grid;gap:8px;padding:8px;border:1px solid #243047;border-radius:8px;background:#111827;"
        >
          <div
            id="clock-player-white"
            data-color="w"
            style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:#1f2937;"
          >
            <span>White</span>
            <div style="text-align:right;">
              <div id="clock-w-time" style="font-variant-numeric:tabular-nums;">--:--</div>
              <div id="clock-w-increment" style="font-size:0.75rem;color:#9ca3af;"></div>
            </div>
          </div>
          <div
            id="clock-player-black"
            data-color="b"
            style="display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;background:#111827;"
          >
            <span>Black</span>
            <div style="text-align:right;">
              <div id="clock-b-time" style="font-variant-numeric:tabular-nums;">--:--</div>
              <div id="clock-b-increment" style="font-size:0.75rem;color:#9ca3af;"></div>
            </div>
          </div>
        </section>
        <label for="puzzle-select">Puzzles:</label>
        <select id="puzzle-select" style="display:block;margin:4px 0 12px;">
          <option value="-1">Free Play</option>
        </select>
        <div id="status" role="status" aria-live="polite" style="min-height:1.5em;"></div>
        <section
          aria-label="Evaluation insights"
          style="padding:8px;border:1px solid #243047;border-radius:8px;background:#111827;display:grid;gap:8px;"
        >
          <div style="display:flex;height:160px;flex-direction:column;justify-content:space-between;">
            <div
              id="evaluation-bar-fill"
              style="flex:1;background:linear-gradient(#38bdf8,#22d3ee);border-radius:4px 4px 0 0;margin-bottom:auto;height:50%;"
            ></div>
            <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:#9ca3af;">
              <span>White</span>
              <span>Black</span>
            </div>
          </div>
          <div id="evaluation-score" style="font-size:1.25rem;text-align:center;">+0.0</div>
          <canvas
            id="evaluation-history"
            width="240"
            height="80"
            aria-hidden="true"
            style="width:100%;height:80px;border-radius:4px;background:#0f172a;"
          ></canvas>
          <div style="font-size:0.75rem;color:#9ca3af;">Advantage swings</div>
          <ul id="evaluation-swings" style="list-style:none;margin:0;padding:0;display:grid;gap:4px;"></ul>
        </section>
        <section
          style="padding:8px;border:1px solid #243047;border-radius:8px;background:#111827;display:grid;gap:8px;"
          aria-label="Training ladder"
        >
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <span>Training Ladder</span>
            <span id="training-streak" style="font-size:0.75rem;color:#9ca3af;">Streak 0</span>
          </div>
          <p id="training-status" style="margin:0;font-size:0.85rem;">Start a guided challenge to sharpen your tactics.</p>
          <div
            id="training-progress"
            style="height:6px;border-radius:999px;background:#1f2937;overflow:hidden;"
          ></div>
          <div style="display:flex;gap:8px;">
            <button id="training-start" type="button" style="flex:1;">Start Ladder</button>
            <button id="training-hint" type="button" style="flex:1;" disabled>Hint</button>
          </div>
        </section>
        <section id="lobby" aria-label="Online play" style="margin-top:16px;">
          <button id="find-match" type="button">Find Match</button>
          <div id="lobby-status" style="min-height:1.5em;"></div>
          <ol id="rankings"></ol>
        </section>
      </aside>
    </main>
    <script src="../../js/bootstrap/gg.js"></script>
    <script src="../../js/preflight.js"></script>
    <script type="module" src="../../js/three-global-shim.js"></script>
    <script type="module">
      import { ensureCanvas, ensureElement } from "../../js/bootstrap/dom.js";
      window.addEventListener("DOMContentLoaded", () => {
        ensureCanvas("board");
        ensureCanvas("fx");
        ensureElement("#status");
        ensureElement("#difficulty");
        ensureElement("#time-control");
        ensureElement("#clock-mode-label");
        ensureElement("#clock-player-white");
        ensureElement("#clock-w-time");
        ensureElement("#clock-w-increment");
        ensureElement("#clock-player-black");
        ensureElement("#clock-b-time");
        ensureElement("#clock-b-increment");
        ensureElement("#puzzle-select");
        ensureElement("#training-start");
        ensureElement("#training-hint");
        ensureElement("#training-status");
        ensureElement("#training-progress");
        ensureElement("#training-streak");
        ensureElement("#evaluation-bar-fill");
        ensureElement("#evaluation-score");
        ensureCanvas("evaluation-history");
        ensureElement("#evaluation-swings");
        ensureElement("#lobby");
        ensureElement("#lobby-status");
        ensureElement("#rankings");
        ensureElement("#find-match");
      });
    </script>
    <script src="../../games/chess/ai.js?v=5.3"></script>
    <script src="../../games/chess/puzzles.js?v=5.3"></script>
    <script src="../../games/chess/ratings.js?v=5.3"></script>
    <script src="../../games/chess/net.js?v=5.3"></script>
    <script type="module" src="../../games/chess/chess.js?v=5.3"></script>
    <script src="../../js/input.js?v=5.3"></script>
    <script src="../../js/remapUI.js?v=5.3"></script>
    <script src="../../js/perfHud.js?v=5.3"></script>
  
<!-- Auto-signal bootstrap: emits READY/ERROR to parent -->
<script>
(function(){
  if (window.__gg_autoSignalInstalled) return; window.__gg_autoSignalInstalled = true;
  function post(type, payload){ try { parent && parent.postMessage(Object.assign({type}, payload||{}), location.origin); } catch(e){} }
  window.addEventListener("error", e => post("GAME_ERROR", { error: (e.message || String(e.error || e)).slice(0,500) }));
  window.addEventListener("unhandledrejection", e => {
    const r = e && e.reason ? (e.reason.message || String(e.reason)) : "unhandled rejection";
    post("GAME_ERROR", { error: String(r).slice(0,500) });
  });
  function ready(){ post("GAME_READY"); }
  if (document.readyState === "complete") setTimeout(ready, 0);
  else window.addEventListener("load", () => setTimeout(ready, 0));
})();
</script>
</body>
</html>
